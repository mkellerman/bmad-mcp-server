# Test Suite: Doctor Workflow
# Validates BMAD doctor diagnostic workflow (*doctor and *doctor --full)

test_suite: 'Doctor Workflow Tests'
description: 'Test BMAD doctor health diagnostic commands'

config:
  llm_model: 'gpt-4.1'
  temperature: 0.1
  timeout: 30000
  judge_model: 'gpt-4.1'
  judge_threshold: 0.75

tests:
  - id: 'doctor-001'
    name: 'Execute doctor summary view'
    prompt: |
      You have a bmad tool available.

      User request: "Run the BMAD doctor diagnostic to check system health."

      Call the bmad tool with command "*doctor" to get a summary health report.

    expectations:
      - type: 'contains'
        value: 'doctor'
        case_sensitive: false
        description: 'Should execute doctor command'

      - type: 'contains'
        value: 'health'
        case_sensitive: false
        description: 'Should mention health in output'

      - type: 'response_length'
        min: 100
        max: 5000
        description: 'Response should be reasonable length'

  - id: 'doctor-002'
    name: 'Execute doctor full detailed view'
    prompt: |
      User asks: "Show me the full BMAD doctor diagnostic with all details."

      Use bmad tool with command "*doctor --full"

    expectations:
      - type: 'contains'
        value: '--full'
        case_sensitive: false
        description: 'Should use full flag'

      - type: 'contains'
        value: 'detail'
        case_sensitive: false
        description: 'Should mention detailed information'

      - type: 'response_length'
        min: 200
        max: 10000
        description: 'Full mode should have more content'

  - id: 'doctor-003'
    name: 'Doctor shows health score'
    prompt: |
      User request: "Check the BMAD health score."

      Call bmad with "*doctor" and look for health score information.

    expectations:
      - type: 'contains'
        value: 'score'
        case_sensitive: false
        description: 'Should show health score'

      - type: 'contains'
        value: '%'
        case_sensitive: false
        description: 'Should show percentage'

  - id: 'doctor-004'
    name: 'Doctor shows resource counts'
    prompt: |
      User asks: "How many agents, workflows, and tasks are available in BMAD?"

      Use "*doctor" to check resource counts.

    expectations:
      - type: 'contains'
        value: 'agent'
        case_sensitive: false
        description: 'Should mention agents'

      - type: 'contains'
        value: 'workflow'
        case_sensitive: false
        description: 'Should mention workflows'

      - type: 'contains'
        value: 'task'
        case_sensitive: false
        description: 'Should mention tasks'

  - id: 'doctor-005'
    name: 'Doctor reports active location'
    prompt: |
      User request: "Where is BMAD currently loading resources from?"

      Run "*doctor" to see active BMAD location.

    expectations:
      - type: 'contains'
        value: 'location'
        case_sensitive: false
        description: 'Should show location information'

      - type: 'contains'
        value: 'active'
        case_sensitive: false
        description: 'Should indicate active location'

  - id: 'doctor-006'
    name: 'Doctor detects orphaned files'
    prompt: |
      User asks: "Are there any orphaned BMAD files that aren't registered?"

      Use "*doctor" to check for orphaned files.

    expectations:
      - type: 'response_length'
        min: 50
        max: 8000
        description: 'Should return diagnostic information'

  - id: 'doctor-007'
    name: 'Doctor provides recommendations'
    prompt: |
      User request: "What actions does BMAD doctor recommend?"

      Run "*doctor" and look for recommended actions.

    expectations:
      - type: 'contains'
        value: 'recommend'
        case_sensitive: false
        description: 'Should provide recommendations'

  - id: 'doctor-008'
    name: 'Full mode shows file listings'
    prompt: |
      User asks: "Show me all BMAD files with their status."

      Use "*doctor --full" to see detailed file listings.

    expectations:
      - type: 'contains'
        value: 'full'
        case_sensitive: false
        description: 'Should execute full mode'

      - type: 'response_length'
        min: 200
        max: 15000
        description: 'Full listing should be comprehensive'

  - id: 'doctor-009'
    name: 'Doctor shows legend in full mode'
    prompt: |
      User request: "What do the symbols mean in the BMAD doctor report?"

      Run "*doctor --full" to see the legend.

    expectations:
      - type: 'contains'
        value: 'legend'
        case_sensitive: false
        description: 'Should include legend'

  - id: 'doctor-010'
    name: 'Doctor handles both modes correctly'
    prompt: |
      User asks: "First show me a summary, then show detailed diagnostics."

      1. Call bmad with "*doctor" for summary
      2. Then call bmad with "*doctor --full" for details

    expectations:
      - type: 'contains'
        value: 'doctor'
        case_sensitive: false
        description: 'Should run doctor command'

      - type: 'response_length'
        min: 150
        max: 15000
        description: 'Should handle both modes'
